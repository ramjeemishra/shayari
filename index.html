<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shayari Website</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="shortcut icon" href="shayarilogo.jpeg" type="image/x-icon">

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, set, get, push } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDPBjSD85dnh4RTj9UWy46TS1zHOFpaoG8",
      authDomain: "shayaridatabase.firebaseapp.com",
      projectId: "shayaridatabase",
      storageBucket: "shayaridatabase.appspot.com",
      messagingSenderId: "255324173170",
      appId: "1:255324173170:web:4f2e7653c3f0f1b9d8a3eb",
      measurementId: "G-BR9FC3D3F3"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const auth = getAuth(app);

    function loadShayaris() {
      const shayariContainer = document.getElementById('shayari-container');
      shayariContainer.innerHTML = '';

      const shayarisRef = ref(database, 'shayaris');
      get(shayarisRef).then((snapshot) => {
        if (snapshot.exists()) {
          snapshot.forEach((childSnapshot) => {
            const shayari = childSnapshot.val();
            const shayariDiv = document.createElement('div');
            shayariDiv.classList.add('bg-gray-800', 'p-4', 'rounded', 'mb-4');
            shayariDiv.innerHTML = `
              <p class="text-sm text-gray-400">${shayari.username} - ${shayari.timestamp}</p>
              <p style="white-space: pre-wrap;">${shayari.content}</p>`;
            shayariContainer.appendChild(shayariDiv);
          });
        } else {
          console.log('No shayaris found');
        }
      }).catch((error) => {
        console.error('Error loading shayaris:', error);
      });
    }

    function login(email, password) {
      signInWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          const user = userCredential.user;
          const usernameRef = ref(database, 'users/' + user.uid + '/username');
          get(usernameRef).then((snapshot) => {
            if (snapshot.exists()) {
              const username = snapshot.val();
              document.getElementById('usernameDisplay').textContent = username;
              document.getElementById('loginButton').style.display = 'none';
              document.getElementById('non-main-shayari-container').style.display = 'block';
              document.getElementById('loginFormContainer').style.display = 'none';
              loadShayaris();
            } else {
              console.error('No username found for this user.');
            }
          }).catch((error) => {
            console.error('Error fetching username:', error);
          });
        })
        .catch((error) => {
          console.error('Error signing in:', error);
          alert('Login failed: ' + error.message);
        });
    }

    function loadUsernames() {
      const usersRef = ref(database, 'users');
      get(usersRef).then((snapshot) => {
        if (snapshot.exists()) {
          const userList = document.getElementById('userList');
          userList.innerHTML = ''; // Clear previous list
          snapshot.forEach((childSnapshot) => {
            const username = childSnapshot.val().username;
            const li = document.createElement('li');
            li.classList.add('text-lg', 'cursor-pointer', 'underline-animation');
            li.textContent = username;
            li.addEventListener('click', () => {
              filterShayarisByUsername(username);
              document.getElementById('userListModal').style.display = 'none';
            });
            userList.appendChild(li);
          });
        } else {
          console.log('No users found');
        }
      }).catch((error) => {
        console.error('Error loading users:', error);
      });
    }

    function filterShayarisByUsername(username) {
      const shayarisRef = ref(database, 'shayaris');
      const shayariContainer = document.getElementById('shayari-container');
      get(shayarisRef).then((snapshot) => {
        shayariContainer.innerHTML = ''; // Clear previous shayaris
        if (snapshot.exists()) {
          snapshot.forEach((childSnapshot) => {
            const shayari = childSnapshot.val();
            if (shayari.username === username) {
              const shayariDiv = document.createElement('div');
              shayariDiv.classList.add('bg-gray-800', 'p-4', 'rounded', 'mb-4');
              shayariDiv.innerHTML = `
                <p class="text-sm text-gray-400">${shayari.username} - ${shayari.timestamp}</p>
                <p style="white-space: pre-wrap;">${shayari.content}</p>`;
              shayariContainer.appendChild(shayariDiv);
            }
          });
        } else {
          console.log('No shayaris found');
        }
      }).catch((error) => {
        console.error('Error filtering shayaris:', error);
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      // Login form
      document.getElementById('loginForm').addEventListener('submit', function (event) {
        event.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        login(email, password);
      });

      // Post shayari form
      document.getElementById('postShayariForm').addEventListener('submit', function (event) {
        event.preventDefault();
        const shayariContent = document.getElementById('shayari').value;

        if (shayariContent) {
          const username = document.getElementById('usernameDisplay').textContent;
          const timestamp = new Date().toLocaleString();
          const shayarisRef = ref(database, 'shayaris');
          const newShayariRef = push(shayarisRef);

          const newShayariData = {
            content: shayariContent,
            username: username,
            timestamp: timestamp
          };

          set(newShayariRef, newShayariData)
            .then(() => {
              alert('Shayari posted successfully!');
              document.getElementById('shayari').value = '';
              loadShayaris();
            })
            .catch(error => {
              console.error('Error posting shayari:', error);
            });
        } else {
          alert('Please enter a shayari');
        }
      });

      // View users button
      document.getElementById('viewUsersButton').addEventListener('click', () => {
        loadUsernames();
        document.getElementById('userListModal').style.display = 'flex';
      });

      // Close user list modal
      document.getElementById('closeUserList').addEventListener('click', () => {
        document.getElementById('userListModal').style.display = 'none';
      });

      loadShayaris(); // Initial loading of shayaris
    });
  </script>

  <style>
    @keyframes fadeIn {
      0% {
        opacity: 0;
        transform: translateY(20px);
      }

      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in {
      animation: fadeIn 0.8s ease-in-out;
    }

    .neon-btn {
      background: linear-gradient(145deg, #3b4148, #20262d);
      box-shadow: 0 0 15px rgba(59, 65, 72, 0.7), inset 0 0 15px rgba(50, 50, 50, 0.7);
      transition: all 0.3s ease;
      border-radius: 9999px;
    }

    .neon-btn:hover {
      box-shadow: 0 0 25px #4ade80, 0 0 30px #4ade80;
      transform: translateY(-3px);
    }

    .dark-card {
      background: linear-gradient(145deg, #222831, #1a1f25);
      box-shadow: 4px 4px 12px rgba(0, 0, 0, 0.8), -4px -4px 12px rgba(50, 50, 50, 0.2);
      border-radius: 20px;
      padding: 1.5rem;
      transition: transform 0.5s ease;
    }

    .dark-card:hover {
      transform: translateY(-5px);
      box-shadow: 0px 8px 20px rgba(0, 0, 0, 0.8), -4px -4px 15px rgba(50, 50, 50, 0.2);
    }

    .glow-text {
      color: #fff;
      text-shadow: 0 0 5px #4ade80, 0 0 10px #4ade80, 0 0 20px #4ade80;
    }

    .dark-input {
      background-color: #1f2937;
      border: 1px solid #3b4148;
      padding: 0.8rem;
      border-radius: 8px;
      outline: none;
      transition: border-color 0.3s ease;
    }

    .dark-input:focus {
      border-color: #4ade80;
    }

    .bg-animated {
      background: linear-gradient(120deg, #20262d, #1f2937, #111827);
      background-size: 600% 600%;
      animation: gradientShift 10s ease infinite;
    }

    @keyframes gradientShift {
      0% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }

      100% {
        background-position: 0% 50%;
      }
    }

    .underline-animation {
      position: relative;
      display: inline-block;
      color: #4ade80;
      text-decoration: none;
    }

    .underline-animation::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 2px;
      bottom: 0;
      left: 0;
      background-color: #4ade80;
      visibility: hidden;
      transform: scaleX(0);
      transition: all 0.3s ease-in-out;
    }

    .underline-animation:hover::after {
      visibility: visible;
      transform: scaleX(1);
    }

    .dark-textarea {
      background-color: #1f2937;
      border: 1px solid #3b4148;
      padding: 0.8rem;
      border-radius: 10px;
      resize: none;
      transition: border-color 0.3s ease;
    }

    .dark-textarea:focus {
      border-color: #60a5fa;
    }
    #userList li{
      padding-top: 3%;
    }
  </style>
</head>

<body class="bg-animated text-white">
  <!-- Navbar -->
  <nav class="bg-gray-800 p-4 flex justify-between items-center shadow-xl dark-card mx-4 my-4">
    <div
      class="text-3xl font-bold tracking-wide text-transparent bg-clip-text bg-gradient-to-r from-green-400 via-blue-400 to-purple-600 transform transition duration-500 hover:scale-110">
      <a href="#">The Shayari Section</a>
    </div>
    <div>
      <span id="usernameDisplay" class="mr-4"></span>
      <button id="loginButton" class="bg-blue-600 text-white py-2 px-4 rounded-lg neon-btn"
        onclick="document.getElementById('loginFormContainer').style.display = 'block';">Login</button>
      <button id="viewUsersButton" class="bg-purple-600 text-white py-2 px-4 rounded-lg neon-btn">View Users</button>
    </div>
  </nav>
  <div id="loginFormContainer" class="p-6 fade-in max-w-md mx-auto dark-card glassmorph" style="display: none;">
    <h2 class="text-2xl font-semibold mb-4 text-center glow-text whatever">Login</h2>
    <form id="loginForm" class="p-4">
      <div class="mb-4">
        <label class="block text-sm mb-2" for="email">Email:</label>
        <input type="email" id="email" class="dark-input w-full" required />
      </div>
      <div class="mb-4">
        <label class="block text-sm mb-2" for="password">Password:</label>
        <input type="password" id="password" class="dark-input w-full" required />
      </div>
      <button type="submit" class="neon-btn w-full py-3 text-lg">Login</button>
      <p style="padding-top: 3.5%;">don't have account <a href="main.html"
          style="color: skyblue; padding-top: 0.5%; padding-left: 1%; margin-right: 2%;">create account.</a> Then login
        again</p>
    </form>
  </div>
  <!-- Shayari section -->
  <section id="shayari-section" class="p-6 fade-in max-w-2xl mx-auto dark-card my-6" style="display: none;">
    <h2 class="text-2xl font-semibold mb-4 text-center glow-text">Post a Shayari</h2>
    <form id="postShayariForm" class="p-4">
      <div class="mb-4">
        <label class="block text-sm mb-2" for="shayari">Shayari:</label>
        <textarea id="shayari" class="dark-textarea w-full" rows="4" required></textarea>
      </div>
      <button type="submit" class="neon-btn w-full py-3 text-lg">Post Shayari</button>
    </form>
  </section>
  <section id="non-main-shayari-container">
    <section id="shayari-container" class="p-6 max-w-2xl mx-auto fade-in" style="display: flex; flex-direction: column-reverse; height: 80dvh; overflow-y: scroll; scrollbar-width: none;">
    </section>
  </section>



  <!-- User List Modal -->
  <div id="userListModal" style="display:none; overflow-y: scroll;"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
      <h2 class="text-xl font-semibold mb-4">All User's</h2>
      <ul id="userList" class="list-disc pl-6" style="display: grid; overflow-y: scroll; height: 24dvh; background: #f0f8ff1c; width: fit-content; border-radius: 5%; color: skyblue; scrollbar-width: none; padding-right: 22px;"></ul>
      <button id="closeUserList" class="mt-4 bg-red-600 text-white py-2 px-4 rounded-lg">Close</button>
    </div>
  </div>

</body>

</html>